<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaxonDBBuilder GUI</title>
    <script type="module" src="/src/main.js" defer></script>
  </head>
  <body>
    <main class="app-shell">
      <aside class="side-pane">
        <header class="app-header">
          <h1>TaxonDBBuilder GUI</h1>
          <p class="sub">Tauri / Local only / Sidecar execution</p>
        </header>

        <nav class="tabs">
          <button id="tab-setup" class="tab active">Run Setup</button>
          <button id="tab-monitor" class="tab" disabled>Run Monitor</button>
          <button id="tab-results" class="tab" disabled>Results</button>
        </nav>

        <div class="side-note">
          <h2>Quick Guide</h2>
          <p>1. Taxid and output folder are required.</p>
          <p>2. Keep post_prep enabled for CSV reports.</p>
          <p>3. Use resume for retry after transient API errors.</p>
        </div>

        <div class="side-note config-import">
          <h2>Config Import</h2>
          <p>Load existing <code>db.toml</code> and apply it to GUI fields.</p>
          <button id="load-db-toml" type="button" class="primary">Load db.toml</button>
          <p id="loaded-db-toml" class="loaded-db-path">No file loaded</p>
        </div>
      </aside>

      <section class="content-pane">
        <section id="view-setup" class="view active">
          <form id="setup-form" class="setup-form">
            <section class="card card-guide">
              <div class="guide-head">
                <div class="guide-badge">TB</div>
                <div>
                  <h3>Ready to Build?</h3>
                  <p class="guide-copy">Start from required inputs, then add optional filters and post prep.</p>
                </div>
              </div>
              <div class="guide-arrow">Fill required fields in order: Taxid -> Marker -> Output -> Email</div>
              <ul id="flow-checklist" class="flow-checklist">
                <li id="flow-taxids" class="flow-item pending">1. Add at least one taxid</li>
                <li id="flow-markers" class="flow-item pending">2. Add at least one marker</li>
                <li id="flow-output" class="flow-item pending">3. Select output directory</li>
                <li id="flow-email" class="flow-item pending">4. Set NCBI email</li>
              </ul>
              <div class="post-guide">
                <p class="post-guide-title">Post Prep Guide (optional)</p>
                <ul class="flow-checklist post-flow-checklist">
                  <li id="flow-post-enable" class="flow-item neutral">Enable post prep when you need trimmed/filtered output.</li>
                  <li id="flow-post-primer" class="flow-item neutral">If primer_trim is selected, set primer_file and primer_set.</li>
                  <li id="flow-post-length" class="flow-item neutral">If length_filter is selected, set post min or post max.</li>
                </ul>
              </div>
            </section>

            <section class="card card-taxon">
              <h3>Taxon Input</h3>
              <label for="taxid-input">taxid</label>
              <div class="taxid-entry">
                <input
                  id="taxid-input"
                  type="text"
                  placeholder="32443 or 32443,7777 or multiline paste"
                  autocomplete="off"
                />
                <button id="add-taxid" type="button">Add</button>
              </div>
              <div class="taxid-toolbar">
                <span id="taxid-count">0 taxids</span>
                <button id="clear-taxids" type="button">Clear all</button>
              </div>
              <ul id="taxid-list" class="taxid-list"></ul>
              <textarea id="taxids" class="hidden-taxids" aria-hidden="true"></textarea>
            </section>

            <section class="card card-output">
              <h3>Output Options</h3>
              <label for="output-prefix">output_prefix</label>
              <input id="output-prefix" type="text" value="MiFish" />
              <label for="output-root">output directory</label>
              <div class="inline">
                <input id="output-root" type="text" placeholder="/home/user/MiFish_runs" required />
                <button id="pick-output" type="button">Browse</button>
              </div>
            </section>

            <section class="card card-marker">
              <h3>Marker</h3>
              <label for="marker">marker selector</label>
              <div class="taxid-entry">
                <select id="marker" required>
                  <option value="12s">12s</option>
                  <option value="16s">16s</option>
                  <option value="coi">coi</option>
                  <option value="cytb">cytb</option>
                  <option value="mitogenome">mitogenome</option>
                </select>
                <button id="add-marker" type="button">Add</button>
              </div>
              <div class="taxid-toolbar">
                <span id="marker-count">0 markers</span>
                <button id="clear-markers" type="button">Clear all</button>
              </div>
              <ul id="marker-list" class="taxid-list marker-list"></ul>
            </section>

            <section class="card card-exec">
              <h3>Execution</h3>
              <label for="speed">speed</label>
              <select id="speed">
                <option value="4">low (4)</option>
                <option value="8" selected>medium (8)</option>
                <option value="16">high (16)</option>
              </select>
              <label class="check"><input id="resume" type="checkbox" checked /> resume</label>
            </section>

            <section class="card card-ncbi">
              <h3>NCBI</h3>
              <label for="email">email</label>
              <input id="email" type="email" placeholder="your.email@example.com" required />
              <label for="api-key">api_key</label>
              <input id="api-key" type="password" placeholder="optional" />
              <label class="check"><input id="save-api-key" type="checkbox" /> save api_key</label>
            </section>

            <section class="card card-filters">
              <h3>Filters</h3>
              <label class="check"><input id="f-mito" type="checkbox" checked /> mitochondrion</label>
              <label class="check"><input id="f-ddbj" type="checkbox" checked /> ddbj_embl_genbank</label>
              <label class="check"><input id="f-biomol" type="checkbox" checked /> biomol_genomic</label>
              <label for="f-length-min">length_min</label>
              <input id="f-length-min" type="number" min="0" placeholder="example: 120" />
              <label for="f-length-max">length_max</label>
              <input id="f-length-max" type="number" min="0" placeholder="example: 30000" />
            </section>

            <section class="card card-postprep">
              <h3>Post Prep</h3>
              <label class="check"><input id="post-enable" type="checkbox" /> enable</label>
              <label for="primer-file">primer_file</label>
              <div class="inline">
                <input id="primer-file" type="text" placeholder="/path/to/primers.toml" />
                <button id="pick-primer" type="button">Browse</button>
              </div>
              <label for="primer-set">primer_set (comma separated)</label>
              <input id="primer-set" type="text" placeholder="mifish_u,mifish_ev2" />

              <label>steps</label>
              <div class="step-grid">
                <label class="check"><input class="post-step" value="primer_trim" type="checkbox" /> primer_trim</label>
                <label class="check"><input class="post-step" value="length_filter" type="checkbox" /> length_filter</label>
                <label class="check"><input class="post-step" value="duplicate_report" type="checkbox" checked /> duplicate_report</label>
              </div>

              <label for="post-length-min">post sequence_length_min</label>
              <input id="post-length-min" type="number" min="0" />
              <label for="post-length-max">post sequence_length_max</label>
              <input id="post-length-max" type="number" min="0" />
            </section>

            <div class="actions">
              <button id="run" type="submit" class="primary">Run</button>
              <button id="reset" type="button">Reset</button>
            </div>
          </form>
        </section>

        <section id="view-monitor" class="view">
          <div class="card monitor-header">
            <div><strong>Status:</strong> <span id="status">Idle</span></div>
            <div><strong>Phase:</strong> <span id="phase">-</span></div>
            <progress id="progress" max="100" value="0"></progress>
          </div>

          <div class="card metrics">
            <h3>Metrics</h3>
            <ul id="metrics-list"></ul>
          </div>

          <div class="card logs">
            <h3>Realtime Log</h3>
            <pre id="log-view"></pre>
          </div>

          <div class="actions">
            <button id="cancel" class="danger">Cancel</button>
          </div>
        </section>

        <section id="view-results" class="view">
          <div class="card">
            <h3>Output Files</h3>
            <ul id="result-files"></ul>
            <div class="actions">
              <button id="open-job-dir">Open folder</button>
              <button id="new-job" class="primary">New job</button>
            </div>
          </div>
        </section>
      </section>
    </main>
  </body>
</html>
